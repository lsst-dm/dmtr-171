% generated from JIRA project LVV
% using template at /usr/local/lib/python3.7/site-packages/docsteady/templates/dm-tpr.latex.jinja2.
% using docsteady version 1.2rc24
% Please do not edit -- update information in Jira instead

\documentclass[DM,lsstdraft,STR,toc]{lsstdoc}
\usepackage{geometry}
\usepackage{longtable,booktabs}
\usepackage{enumitem}
\usepackage{arydshln}
\usepackage{attachfile}
\usepackage{array}

\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}p{#1}}

\input meta.tex

\newcommand{\attachmentsUrl}{https://github.com/\gitorg/\lsstDocType-\lsstDocNum/blob/\gitref/attachments}
\providecommand{\tightlist}{
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\setcounter{tocdepth}{4}

\begin{document}

\def\milestoneName{ComCam Interface Verification Readiness}
\def\milestoneId{LDM-503-6}
\def\product{Data Management}

\setDocCompact{true}

\title{LDM-503-6: ComCam Interface Verification Readiness Test Plan and Report}
\setDocRef{\lsstDocType-\lsstDocNum}
\date{\vcsdate}
\author{ Michelle Butler }

\input{history_and_info.tex}


\setDocAbstract{
This is the test plan and report for
\textbf{ ComCam Interface Verification Readiness} (LDM-503-6),
an LSST milestone pertaining to the Data Management Subsystem.
}


\maketitle

\section{Introduction}
\label{sect:intro}


\subsection{Objectives}
\label{sect:objectives}

 This test campaign will verify the readiness of the ComCam DM interface.
This milestone records successful transfer of an image equivalent to one
raft from the DAQ at the summit to reliable storage in the LSST Data
Facility at NCSA, from where it will be made available for scientific
evaluation through the Rubin Science Platform ~There are many steps
along the way from the DAQ to the L1 handoff machine, ~transferred to
NCSA and ingested into the permanent record of the survey. ~~



\subsection{System Overview}
\label{sect:systemoverview}

 The system includes the ComCam DAQ at the summit, and the ComCam DAQ
network connecting the ComCam systems to the support infrastructure at
the base. ~ On the ComCam DAQ network is the ComCam-header service
system, the ComCam-forwarder, ComCam-archiver, and on a base network the
L1 handoff with the OODS and DBB services. ~At NCSA, the DBB ingest
environment, the raw image file systems, the ingested image file systems
and the RSP notebook aspect ~ This milestone includes many steps. ~ It
will ensure that image data can be acquired from the camera, ~a single
YAML header file is generated for all 9 CCDs (or sensors), is ingested
into a butler into the ~Base Data Center ~file systems, served through
NFS for the base systems for quick look capabilities, made available for
DBB resources, transferred to NCSA, ingested by a butler into ~NCSA
filesystems and made available for processing/viewing by the RSP.
~\\[2\baselineskip]

\subsection{Applicable Documents}\label{applicable-documents}

\citeds{LDM-294} Data Management Organization and Management\\
\citeds{LDM-503} DM Test Plan\\
\citeds{LDM-148} Data Management System Design\\
\citeds{LDM-639} Data Management Test Specification\\[2\baselineskip]


\subsection{Document Overview}
\label{sect:docoverview}

This document was generated from Jira, obtaining the relevant information from the
\href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testPlan/LVV-P50}{LVV-P50}
~Jira Test Plan and related Test Cycles (
\href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testCycle/LVV-C106}{LVV-C106}
).

Section \ref{sect:intro} provides an overview of the test campaign, the system under test (\product{}),
the applicable documentation, and explains how this document is organized.
Section \ref{sect:testplan} provides additional information about the test plan, like for example the configuration
used for this test or related documentation.
Section \ref{sect:personnel} describes the necessary roles and lists the individuals assigned to them.

Section \ref{sect:overview} provides a summary of the test results, including an overview in Table \ref{table:summary},
an overall assessment statement and suggestions for possible improvements.
Section \ref{sect:detailedtestresults} provides detailed results for each step in each test case.

The current status of test plan \href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testPlan/LVV-P50}{LVV-P50} in Jira is \textbf{ Completed }.

\subsection{References}
\label{sect:references}
\renewcommand{\refname}{}
\bibliography{lsst,refs,books,refs_ads,local}


\newpage
\section{Test Plan Details}
\label{sect:testplan}


\subsection{Data Collection}

  Observing is not required for this test campaign.

\subsection{Verification Environment}
\label{sect:hwconf}
  The verification environment includes the DAQ, ComCam-archiver,
ComCam-header service, ComCam-forwarder, L1-handoff, long haul network,
NCSA DBB gateway environments, GPFS file systems at NCSA, and the RSP at
NCSA. ~~

  \subsection{Entry Criteria}
  Images can be taken from the ComCam environment from the summit with
unique names and complete headers.~

  \subsection{Exit Criteria}
  Images can be ingested ingested and available through the RSP at the LDF
for viewing and processing by science staff at NCSA. ~


\subsection{Related Documentation}


No additional documentation provided.


\subsection{PMCS Activity}

Primavera milestones related to the test campaign:
\begin{itemize}
\item LDM-503-6
\end{itemize}


\newpage
\section{Personnel}
\label{sect:personnel}

The personnel involved in the test campaign is shown in the following table.

{\small
\begin{longtable}{p{3cm}p{3cm}p{3cm}p{6cm}}
\hline
\multicolumn{2}{r}{T. Plan \href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testPlan/LVV-P50}{LVV-P50} owner:} &
\multicolumn{2}{l}{\textbf{ Michelle Butler } }\\\hline
\multicolumn{2}{r}{T. Cycle \href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testCycle/LVV-C106}{LVV-C106} owner:} &
\multicolumn{2}{l}{\textbf{
Michelle Butler }
} \\\hline
\textbf{Test Cases} & \textbf{Assigned to} & \textbf{Executed by} & \textbf{Additional Test Personnel} \\ \hline
\href{https://jira.lsstcorp.org/secure/Tests.jspa#/testCase/LVV-T1549}{LVV-T1549}
& {\small Michelle Butler } & {\small Michelle Butler } &
\begin{minipage}[]{6cm}
\smallskip
{\small Michelle Gower and Michelle Butler ~and Steve P and Felipe M.~ }
\medskip
\end{minipage}
\\ \hline
\end{longtable}
}

\newpage

\section{Test Campaign Overview}
\label{sect:overview}

\subsection{Summary}
\label{sect:summarytable}

{\small
\begin{longtable}{p{2cm}cp{2.3cm}p{8.6cm}p{2.3cm}}
\toprule
\multicolumn{2}{r}{ T. Plan \href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testPlan/LVV-P50}{LVV-P50}:} &
\multicolumn{2}{p{10.9cm}}{\textbf{ LDM-503-6: ComCam Interface Verification Readiness }} & Completed \\\hline
\multicolumn{2}{r}{ T. Cycle \href{https://jira.lsstcorp.org/secure/Tests.jspa\#/testCycle/LVV-C106}{LVV-C106}:} &
\multicolumn{2}{p{10.9cm}}{\textbf{ LDM-503-6 ComCam verification readiness }} & Done \\\hline
\textbf{Test Cases} &  \textbf{Ver.} & \textbf{Status} & \textbf{Comment} & \textbf{Issues} \\\toprule
\href{https://jira.lsstcorp.org/secure/Tests.jspa#/testCase/LVV-T1549}{LVV-T1549}
&  1
& Pass &
\begin{minipage}[]{9cm}
\smallskip
The testing of the comcam subsystem was completed many times with
testing, but the largest test cycle was done during the Operations
rehearsal \#2 work. ~Images were take on the comcam DAQ system installed
at the Base Data Center because the summit was closed due to COVID. ~
There were 3 sets of image types and multiplies take for each set. ~
~There were darks ~flats, and bias images taken. ~Each of those had 9
CCD fits files images generated and transferred over the LHN to NCSA.
~They were monitored throughout the path, and ingested. ~ Other science
team members ran ISR pipelines (Gen2) on the images, and reported
feedback to the OR2 team. ~ There were team calls once a day to review
the progress and how the OR2 went that day.~ ~
\medskip
\end{minipage}
&   \\\hline
\caption{Test Campaign Summary}
\label{table:summary}
\end{longtable}
}

\subsection{Overall Assessment}
\label{sect:overallassessment}

All files generated well with no intervention, ~the files transferred
but we found that the SCP protocol that was used was VERY inefficient
for transferring small files over a long haul network. ~ During the
tests, the team wasn't sure if the LHN was really being used, and what
the ``data transfer'' time really was. ~ ~One slight change from the
original plan, is using the L1 handoff machine for the OODS and DBB
services. ~ The L1-handoff machine is currently not set up at the BDC.~
~For this test the OODS and DBB servers were running on the
ComCam-archiver system. ~ In the future this functionality will be moved
to the L1-handoff machine. ~

\subsection{Recommended Improvements}
\label{sect:recommendations}

The DBBBM needs to use a different protocol than SCP. ~ BBCP would be
much better for performance. ~ Also throughout the tests, it would have
been handy to have someone on the team check the LHN to see if we used
the LHN, backup networks, and what the speeds of the LHN. ~ We will add
a networking person to the OR team. ~\\[2\baselineskip]

\newpage
\section{Detailed Test Results}
\label{sect:detailedtestresults}

\subsection{Test Cycle LVV-C106 }

Open test cycle {\it \href{https://jira.lsstcorp.org/secure/Tests.jspa#/testrun/LVV-C106}{LDM-503-6 ComCam verification readiness}} in Jira.

Test Cycle name: LDM-503-6 ComCam verification readiness\\
Status: Done

Verify that the DM services required for ComCam exist and are ready to
recieve a image from the comcam DAQ at the summit and transfer the file
to NCSA for viewing on the RSP. ~~

\subsubsection{Software Version/Baseline}
Not provided.

\subsubsection{Configuration}
There are many pieces here. ~ ~ComCam DAQ, ComCam-header service, ComCam
archiver/forwarder, DTN transfers, ~DM butler/G3, LDF file systems, LDF
RSP.~

\subsubsection{Test Cases in LVV-C106 Test Cycle}

\paragraph{ LVV-T1549 - LDM-503-6 Comcam verification readiness }\mbox{}\\

Version \textbf{1}.
Open  \href{https://jira.lsstcorp.org/secure/Tests.jspa#/testCase/LVV-T1549}{\textit{ LVV-T1549 } }
test case in Jira.

Verify that ComCam has all the services running and verified working for
retrieving an image from the ComCam DAQ and store it on file systems at
the LDF for viewing by RSP. ~

\textbf{ Preconditions}:\\
ComCam must be In LaSerena and producing images with proper headers. ~

Execution status: {\bf Pass }

Final comment:\\The testing of the comcam subsystem was completed many times with
testing, but the largest test cycle was done during the Operations
rehearsal \#2 work. ~Images were take on the comcam DAQ system installed
at the Base Data Center because the summit was closed due to COVID. ~
There were 3 sets of image types and multiplies take for each set. ~
~There were darks ~flats, and bias images taken. ~Each of those had 9
CCD fits files images generated and transferred over the LHN to NCSA.
~They were monitored throughout the path, and ingested. ~ Other science
team members ran ISR pipelines (Gen2) on the images, and reported
feedback to the OR2 team. ~ There were team calls once a day to review
the progress and how the OR2 went that day.~ ~


Detailed steps results:

\begin{longtable}{p{1cm}p{15cm}}
\hline
{Step} & Step Details\\ \hline
1 & Description \\
 & \begin{minipage}[t]{15cm}
{\footnotesize
CC-DAQ produces an image~

\medskip }
\end{minipage}
\\ \cdashline{2-2}

 & Test Data \\
 & \begin{minipage}[t]{15cm}{\footnotesize
DAQ produces a SAL message that a image has been created~

\medskip }
\end{minipage} \\ \cdashline{2-2}

 & Expected Result \\
 & \begin{minipage}[t]{15cm}{\footnotesize
in memory file created in DAQ

\medskip }
\end{minipage} \\ \cdashline{2-2}

 & Actual Result \\
 & \begin{minipage}[t]{15cm}{\footnotesize
1 raft scale (9CCDs) have been created.~ ~

\medskip }
\end{minipage} \\ \cdashline{2-2}

 & Status: \textbf{ Pass } \\ \hline

2 & Description \\
 & \begin{minipage}[t]{15cm}
{\footnotesize
Archiver and Forwarder build image with proper header from header
service~

\medskip }
\end{minipage}
\\ \cdashline{2-2}

 & Test Data \\
 & \begin{minipage}[t]{15cm}{\footnotesize
Good image file with proper header with all 9 CCDs~

\medskip }
\end{minipage} \\ \cdashline{2-2}

 & Expected Result \\
 & \begin{minipage}[t]{15cm}{\footnotesize
9 image files all with individual headers and then 1 header for all 9
images too. ~\\[2\baselineskip]

\medskip }
\end{minipage} \\ \cdashline{2-2}

 & Actual Result \\
 & \begin{minipage}[t]{15cm}{\footnotesize
the headers and the images were built properly.~~

\medskip }
\end{minipage} \\ \cdashline{2-2}

 & Status: \textbf{ Pass } \\ \hline

3 & Description \\
 & \begin{minipage}[t]{15cm}
{\footnotesize
AT-archiver/forwarder transfers the file to the l1-handoff machine.~

\medskip }
\end{minipage}
\\ \cdashline{2-2}

 & Test Data \\
 & \begin{minipage}[t]{15cm}{\footnotesize
l1-handoff machine has image file now on local disk.~~

\medskip }
\end{minipage} \\ \cdashline{2-2}

 & Expected Result \\
 & \begin{minipage}[t]{15cm}{\footnotesize
image file now found on disk on L1-handoff with hardlinks to 2 different
file systems (OODS and DBB) services. ~\\[3\baselineskip]

\medskip }
\end{minipage} \\ \cdashline{2-2}

 & Actual Result \\
 & \begin{minipage}[t]{15cm}{\footnotesize
The actual fits files were created.~~

\medskip }
\end{minipage} \\ \cdashline{2-2}

 & Status: \textbf{ Pass } \\ \hline

4 & Description \\
 & \begin{minipage}[t]{15cm}
{\footnotesize
OODS service running on L1-handoff machine ingests the image file into
Butler/G3 and readies the file systems for the commissioning cluster at
the Base to be able to mount and see the new files.~ ~~

\medskip }
\end{minipage}
\\ \cdashline{2-2}

 & Test Data \\
 & \begin{minipage}[t]{15cm}{\footnotesize
Image file ingested to local butler for Base~

\medskip }
\end{minipage} \\ \cdashline{2-2}

 & Expected Result \\
 & \begin{minipage}[t]{15cm}{\footnotesize
Image file ingested\\[2\baselineskip]

\medskip }
\end{minipage} \\ \cdashline{2-2}

 & Actual Result \\
 & \begin{minipage}[t]{15cm}{\footnotesize
the OODS has the list of files ingested and ready for any system at the
BDC wanting to run against them.~~

\medskip }
\end{minipage} \\ \cdashline{2-2}

 & Status: \textbf{ Pass } \\ \hline

5 & Description \\
 & \begin{minipage}[t]{15cm}
{\footnotesize
DBB transfers the file to NCSA thorough the DBB-gateway machines and DTN
nodes at the base.~~

\medskip }
\end{minipage}
\\ \cdashline{2-2}


 & Expected Result \\
 & \begin{minipage}[t]{15cm}{\footnotesize
data file arrives at file systems at NCSA\\[2\baselineskip]

\medskip }
\end{minipage} \\ \cdashline{2-2}

 & Actual Result \\
 & \begin{minipage}[t]{15cm}{\footnotesize
The files arrived, ingested and placed in directory structure:
/lsstdata/offline/teststand/comcam/Archiver/storage/2020-07-28

\medskip }
\end{minipage} \\ \cdashline{2-2}

 & Status: \textbf{ Pass } \\ \hline

6 & Description \\
 & \begin{minipage}[t]{15cm}
{\footnotesize
Files are ingested into the butler/G3 at NCSA and moved to file systems
that are viewable by the LSP. ~

\medskip }
\end{minipage}
\\ \cdashline{2-2}


 & Expected Result \\
 & \begin{minipage}[t]{15cm}{\footnotesize
data can be seen and retrieved by LSP.~~

\medskip }
\end{minipage} \\ \cdashline{2-2}

 & Actual Result \\
 & \begin{minipage}[t]{15cm}{\footnotesize
The files are then linked for the viewing by science platform on
/project/shared/comcam. ~\\[2\baselineskip]

\medskip }
\end{minipage} \\ \cdashline{2-2}

 & Status: \textbf{ Pass } \\ \hline

\end{longtable}


\input{appendix.tex}
\end{document}
